<h3>Select osu!.db:</h3>
<input id="file_osudb" type="file">
<br>
<button onClick="parseosudb()">parse</button>
<br>
<p id="odbp"></p>
<h3>Select scores.db:</h3>
<input id="file_scoresdb" type="file">
<br>
<button onClick="parsescoresdb()">parse</button>
<br>
<br>
<button onClick="update()">update table</button>
<br>
<div id="tablediv"></div>
<link rel="stylesheet" href="styles.css">
<script src="table.js"></script>
<script src="sorttable.js"></script>
<script src="buffer.js"></script>
<script src="util.js"></script>
<script src="osudb.js"></script>
<script src="scoresdb.js"></script>
<script>
let scores = null,
    beatmaps = null;

function parseosudb(){
	beatmaps = new osudb(document.getElementById("file_osudb").files[0]);
	beatmaps.onload = ()=>{beatmaps.parseOsuDB()};
}

function parsescoresdb(){
	scores = new scoresdb(document.getElementById("file_scoresdb").files[0]);
	scores.onload = ()=>{scores.parseScoresDB()};
}

function update(){
	let table = new sorttable();
	table.headers = ["Player", "SR", "FC", "Combo", "Acc", "300", "100", "50", "Geki", "Katu", "Miss", "Score", "Mode", "Mods", "CS", "AR", "HP", "OD", "BeatmapID", "ScoreID", "Mapname", "Difficulty", "Link"];

	let sHashs = scores.hashs,
	    bHashs = beatmaps.hashs;

	for(let i = 0; i != sHashs.length; i++){
		let j = bHashs.indexOf(sHashs[i]);
		if(j != -1){
			let b = beatmaps.parseBeatmap(beatmaps.beatmaps[j]),
			    ss = scores.parseMapScores(scores.maps[i]).scores;
			for(let k = 0; k != ss.length; k++){
				let s = ss[k];
				table.insertRow({
					Player: s.Player,
					SR: b.StandardSR,
					FC: s.FullCombo,
					Combo: s.Combo,
					Acc: (300*(s[300]+s.Geki) + 100*(s[100]+s.Katu) + 50*s[50])/(300*(s[300] + s[100] + s[50] + s.Geki + s.Katu + s.Miss)) * 100,
					300: s[300],
					100: s[100],
					50: s[50],
					Geki: s.Geki,
					Katu: s.Katu,
					Miss: s.Miss,
					Score: s.Score,
					Mode: s.Mode,
					Mods: s.Mods,
					CS: b.CS,
					AR: b.AR,
					HP: b.HP,
					OD: b.OD,
					BeatmapID: b.ID,
					ScoreID: s.ScoreID,
					Mapname: b.SongTitle,
					Difficulty: b.Difficulty,
					Link: "<a href=\"https://osu.ppy.sh/b/" + b.ID + "\">https://osu.ppy.sh/b/" + b.ID + "</a>"
				});
			}
		}
	}
		
	console.log(table);
	tablediv.replaceChildren(table.toHTML());	
}
</script>